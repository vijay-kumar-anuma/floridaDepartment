<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light bg-white px-3">
  <div class="container-fluid">

    <a class="navbar-brand d-flex align-items-center" routerLink="/">
      <img src="https://www.logoai.com/oss/icons/2021/12/02/u8tXD2V7rro6bok.png" alt="Logo" height="45">
      <span class="ms-2 fw-bold text-white">Florida Department of Financial Services</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav align-items-center">
        <li class="nav-item text-white fw-bold">Welcome JOHN!</li>
        <li class="nav-item"><a class="nav-link" routerLink="/download-packets">Download Packets</a></li>
        <li class="nav-item"><a class="nav-link" routerLink="/change-password">Change Password</a></li>
        <li class="nav-item"><a class="nav-link" routerLink="/faq">FAQâ€™s</a></li>
        <li class="nav-item"><a class="nav-link" routerLink="/contact-us">Contact Us</a></li>
        <li class="nav-item"><a class="nav-link text-warning" routerLink="/logout" (click)="logout()">Log Out</a></li>

        <li class="nav-item ms-3 d-none d-lg-block">
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container mt-4">

  <h2 class="fw-bold mb-4">Packets Ready for Download</h2>

  <!-- SEARCH FILTERS -->
  <div class="card p-3 mb-4">
    <form [formGroup]="searchParams">
      <div class="row g-3">
        <div class="col-md-2">
          <label class="form-label">Case Number</label>
          <input type="text" class="form-control" formControlName="case">
        </div>
        <div class="col-md-2">
          <label class="form-label">Plaintiff</label>
          <input type="text" class="form-control" formControlName="plaintiff">
        </div>
        <div class="col-md-2">
          <label class="form-label">Company Served</label>
          <input type="text" class="form-control" formControlName="company">
        </div>
        <div class="col-md-3">
          <label class="form-label">Date Served From</label>
          <input type="date" class="form-control" formControlName="received">
        </div>
        <div class="col-md-3">
          <label class="form-label">Date Served To</label>
          <input type="date" class="form-control" formControlName="served">
        </div>
      </div>
    </form>

    <div class="row mt-3">
      <div class="col-md-12 d-flex gap-2">
        <button type="button" class="btn btn-primary px-4" (click)="filterTable()">Search</button>
        <button type="button" class="btn btn-info text-white px-4" (click)=clear()>Clear</button>
      </div>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-primary">
        <tr>
          <th>
            <input type="checkbox" (change)="toggleSelectAll($event)">
          </th>
          <th>SOP Number</th>
          <th>Case Number</th>
          <th>Plaintiff</th>
          <th>Company To Serve</th>
          <th>Date Received</th>
          <th>Date Served</th>
        </tr>
      </thead>

      <tbody>
        <ng-container *ngIf="filterDisplayedPackets.length > 0; else noData">
          <tr *ngFor="let packet of filterDisplayedPackets">
            <td>
              <input type="checkbox" [(ngModel)]="packet.selected">
            </td>
            <td>{{ packet.sop }}</td>
            <td>{{ packet.case }}</td>
            <td>{{ packet.plaintiff }}</td>
            <td>{{ packet.company }}</td>
            <td>{{ packet.received | date: 'M/d/yyyy' }}</td>
            <td>{{ packet.served | date: 'M/d/yyyy' }}</td>
          </tr>
        </ng-container>
        <ng-template #noData>
          <tr>
            <td colspan="7">No Data Found...</td>
          </tr>
        </ng-template>
      </tbody>
    </table>
  </div>

  <!-- PAGINATION -->
  <nav aria-label="Page navigation" class="mt-2">
    <ul class="pagination justify-content-end">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="prevPage()">Previous</a>
      </li>

      <li class="page-item" *ngFor="let page of getPages()" [class.active]="currentPage === page">
        <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <a class="page-link" (click)="nextPage()">Next</a>
      </li>
    </ul>
  </nav>
  <div class="d-flex justify-content-end mt-2">
    <button class="btn btn-download px-4 btn btn-success" (click)="downloadPDF()"> Download
    </button>

  </div>

  <a href="#" class="text-primary mt-2 d-block">View Packets Previously Downloaded</a>

  <div class="my-3">
    <label class="form-label me-3">Upload File</label>

    <input type="file" #fileInput class="d-none" (change)="onFileSelected($event, fileUploadModal)" />

    <button class="btn btn-primary" (click)="fileInput.click()">
      Choose File
    </button>

    <span class="ms-3" *ngIf="fileName">
      <i class="bi bi-paperclip"></i> {{ fileName }}
    </span>
  </div>


</div>

<ng-template #fileUploadModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Upload or Add Records</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>

  <div class="modal-body">

    <!-- MANUAL ENTRY FORM -->
    <h5 class="fw-bold">Add Manual Record</h5>

    <div class="row g-3 border p-3 mb-3 rounded">
      <div class="col-md-4">
        <label class="form-label">SOP Number</label>
        <input class="form-control" [(ngModel)]="manualRecord.sop">
      </div>

      <div class="col-md-4">
        <label class="form-label">Case Number</label>
        <input class="form-control" [(ngModel)]="manualRecord.case">
      </div>

      <div class="col-md-4">
        <label class="form-label">Plaintiff</label>
        <input class="form-control" [(ngModel)]="manualRecord.plaintiff">
      </div>

      <div class="col-md-4">
        <label class="form-label">Company</label>
        <input class="form-control" [(ngModel)]="manualRecord.company">
      </div>

      <div class="col-md-4">
        <label class="form-label">Date Received</label>
        <input type="date" class="form-control" [(ngModel)]="manualRecord.received">
      </div>

      <div class="col-md-4">
        <label class="form-label">Date Served</label>
        <input type="date" class="form-control" [(ngModel)]="manualRecord.served">
      </div>
    </div>

    <!-- EXISTING XLS RECORDS TABLE -->
    <div class="table-responsive mt-3">
      <table class="table table-bordered table-striped align-middle">
        <thead class="table-primary">
          <tr>
            <th>SOP Number</th>
            <th>Case Number</th>
            <th>Plaintiff</th>
            <th>Company</th>
            <th>Date Received</th>
            <th>Date Served</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let packet of xlspackets">
            <td>{{ packet.sop }}</td>
            <td>{{ packet.case }}</td>
            <td>{{ packet.plaintiff }}</td>
            <td>{{ packet.company }}</td>
            <td>{{ packet.received }}</td>
            <td>{{ packet.served }}</td>
          </tr>

          <tr *ngIf="xlspackets.length === 0">
            <td colspan="7" class="text-center">No File Records Loaded</td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-outline-primary" (click)="addRecords()">Add Records</button>
  </div>
</ng-template>